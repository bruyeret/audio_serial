# Audio Serial

Convert audio to binary data using a custom fast FFT.
Use VS code with the PlatformIO extension to build and upload the project to an Arduino Nano or an Atmega328p.

### General note about scripts

It is advised to use a venv using:
```sh
# Create a venv at the root of the project
python -m venv .
# Activate the environment
./.venv/Scripts/activate
# Install the needed modules
python -m pip install numpy matplotlib pyserial wavio sounddevice
```

### Generating the fast fft header

Before building, you need to create `unrolled_fft.h` in the `include` directory.
This file contains the source code of the custom fast FFT.
It is generated by `generate_fft_code.py` in the `scripts` folder.
Simply run the script using at least python 3.6, with numpy installed.

### Testing FFT

You can use `create_sound.py` and `fft_plot.py` in the `script` directory to test the FFT.

The script `create_sound.py` can be used to play or save audio.
You can choose the phase and amplitude of a fundamental frequency and its harmonics.
There are no command line arguments yet, see the beginning of `main_harmonics` function for settings.

The script `fft_plot.py` listens to a COM port and shows the output of this COM port in a special form.
The COM port should output numbers separated by commas. The end of the line should be a comma and a newline.
There are no command line arguments yet, see the beginning of the file for settings.

### Dissassemble the firmware

You need `objdump` that should be located in the directory:
```sh
${HOME}/.platformio/packages/toolchain-atmelavr/avr/bin
```

Compile in release and run this command to dissassemble the firmware:
```sh
objdump -S .pio/build/release/firmware.elf > dissassembly.asm
```
Or using Windows Powershell, to avoid using UTF16-LE encoding:
```sh
objdump -S .pio/build/release/firmware.elf | Out-File -encoding ASCII dissassembly.asm
```

To get the source code mixed with assembly, but without optimizations, you can also compile in debug and run:
```sh
objdump -S -I include .pio/build/debug/firmware.elf > dissassembly.asm
```
Or alternatively using Windows Powershell:
```sh
objdump -S -I include .pio/build/debug/firmware.elf | Out-File -encoding ASCII dissassembly.asm
```
